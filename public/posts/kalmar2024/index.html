<!DOCTYPE html>
<html lang="en" style="font-size: 100%">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=40099&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <meta name="author" content="Michael Neuper">

  
  
  <meta name="description" content="Last weekend, I played KalmarCTF 2024 with my team @1337%Yogurt. The cryptography category is very hard this year, so I could only manage to solve some of them. Here is my writeup for challenges that are solved by me.
Cracking The Casino
casino.py
#!/usr/bin/python3
from Pedersen_commitments import gen, commit, verify


# I want to host a trustworthy online casino!
# To implement blackjack and craps in a trustworthy way i need verifiable dice and cards!
# I&#39;ve used information theoretic commitments to prevent players from cheating.
# Can you audit these functionalities for me ?

from random import randint
# Verifiable Dice roll
def roll_dice(pk):
    roll = randint(1,6)
    comm, r = commit(pk,roll)
    return comm, roll, r

# verifies a dice roll
def check_dice(pk,comm,guess,r):
    res = verify(pk,comm, r, int(guess))
    return res

# verifiable random card:
def draw_card(pk):
    idx = randint(0,51)
    # clubs spades diamonds hearts
    suits = &#34;CSDH&#34;
    values = &#34;234567890JQKA&#34;
    value = values[idx%13]
    suit = suits[idx//13]
    card = value &#43; suit
    comm, r = commit(pk, int(card.encode().hex(),16))
    return comm, card, r

# take a card (as two chars, fx 4S = 4 of spades) and verifies it was the committed card
def check_card(pk, comm, guess, r):
    res = verify(pk, comm, r, int(guess.encode().hex(),16))
    return res


# Debug testing values for larger values
def debug_test(pk):
    dbg = randint(0,2**32-2)
    comm, r = commit(pk,dbg)
    return comm, dbg, r

# verify debug values
def check_dbg(pk,comm,guess,r):
    res = verify(pk,comm, r, int(guess))
    return res


def audit():
    print(&#34;Welcome to my (beta test) Casino!&#34;)
    q,g,h = gen()
    pk = q,g,h
    print(f&#39;public key for Pedersen Commitment Scheme is:\nq = {q}\ng = {g}\nh = {h}&#39;)
    chosen = input(&#34;what would you like to play?\n[D]ice\n[C]ards&#34;)

    if chosen.lower() == &#34;d&#34;:
        game = roll_dice
        verif = check_dice
    elif chosen.lower() == &#34;c&#34;:
        game = draw_card
        verif = check_card
    else:
        game = debug_test
        verif = check_dbg

    correct = 0
    # If you can guess the committed values more than i&#39;d expect, then
    for _ in range(1337):
        if correct == 100:
            print(&#34;Oh wow, you broke my casino??!? Thanks so much for finding this before launch so i don&#39;t lose all my money to cheaters!&#34;)
            with open(&#34;flag.txt&#34;,&#34;r&#34;) as f:
                flag = f.read()
            print(f&#34;here&#39;s that flag you wanted, you earned it! {flag}&#34;)
            exit()

        comm, v, r = game(pk)
        print(f&#39;Commitment: {comm}&#39;)
        g = input(f&#39;Are you able to guess the value? [Y]es/[N]o&#39;)
        if g.lower() == &#34;n&#34;:
            print(f&#39;commited value was {v}&#39;)
            print(f&#39;randomness used was {r}&#39;)
            print(f&#39;verifies = {verif(pk,comm,v,r)}&#39;)
        elif g.lower() == &#34;y&#34;:
            guess = input(f&#39;whats your guess?&#39;)
            if verif(pk, comm, guess, r):
                correct &#43;= 1
                print(&#34;Oh wow! well done!&#34;)
            else:
                print(&#34;That&#39;s not right... Why are you wasting my time if you haven&#39;t broken anything?&#34;)
                exit()

    print(f&#39;Guess my system is secure then! Lets go ahead with the launch!&#39;)
    exit()

if __name__ == &#34;__main__&#34;:
    audit()
">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="http://localhost:40099//images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="http://localhost:40099//images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="http://localhost:40099//images/favicon-16x16.png">

  
  
  <meta name="keywords" content='hugo latex theme blog texify texify2 texify3 michael neuper'>
  

  
  
  <link rel="stylesheet" href='/katex/katex.min.css'>
<script defer defer src='/katex/katex.min.js'></script>
<script defer src='/katex/contrib/auto-render.min.js'></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          delimiters: [
              {left: '$$', right: '$$', display: true},
              {left: '$', right: '$', display: false},
              {left: '\\(', right: '\\)', display: false},
              {left: '\\[', right: '\\]', display: true}
          ],
          throwOnError : false
        });
    });
</script>
  

  
  <script data-name="BMC-Widget" 
    data-cfasync="true" 
    src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" 
    data-id="michaelneuper" 
    data-description="Like what I do? Buy me a coffee!" 
    data-message="" 
    data-color="#d79921" 
    data-position="Right" 
    data-x_margin="18" 
    data-y_margin="18"
    crossorigin="anonymous">
</script>


  
  <meta property="og:url" content="http://localhost:40099/posts/kalmar2024/">
  <meta property="og:site_name" content="Giap&#39;s Blog">
  <meta property="og:title" content="KalmarCTF 2024">
  <meta property="og:description" content="Last weekend, I played KalmarCTF 2024 with my team @1337%Yogurt. The cryptography category is very hard this year, so I could only manage to solve some of them. Here is my writeup for challenges that are solved by me.
Cracking The Casino casino.py
#!/usr/bin/python3 from Pedersen_commitments import gen, commit, verify # I want to host a trustworthy online casino! # To implement blackjack and craps in a trustworthy way i need verifiable dice and cards! # I&#39;ve used information theoretic commitments to prevent players from cheating. # Can you audit these functionalities for me ? from random import randint # Verifiable Dice roll def roll_dice(pk): roll = randint(1,6) comm, r = commit(pk,roll) return comm, roll, r # verifies a dice roll def check_dice(pk,comm,guess,r): res = verify(pk,comm, r, int(guess)) return res # verifiable random card: def draw_card(pk): idx = randint(0,51) # clubs spades diamonds hearts suits = &#34;CSDH&#34; values = &#34;234567890JQKA&#34; value = values[idx%13] suit = suits[idx//13] card = value &#43; suit comm, r = commit(pk, int(card.encode().hex(),16)) return comm, card, r # take a card (as two chars, fx 4S = 4 of spades) and verifies it was the committed card def check_card(pk, comm, guess, r): res = verify(pk, comm, r, int(guess.encode().hex(),16)) return res # Debug testing values for larger values def debug_test(pk): dbg = randint(0,2**32-2) comm, r = commit(pk,dbg) return comm, dbg, r # verify debug values def check_dbg(pk,comm,guess,r): res = verify(pk,comm, r, int(guess)) return res def audit(): print(&#34;Welcome to my (beta test) Casino!&#34;) q,g,h = gen() pk = q,g,h print(f&#39;public key for Pedersen Commitment Scheme is:\nq = {q}\ng = {g}\nh = {h}&#39;) chosen = input(&#34;what would you like to play?\n[D]ice\n[C]ards&#34;) if chosen.lower() == &#34;d&#34;: game = roll_dice verif = check_dice elif chosen.lower() == &#34;c&#34;: game = draw_card verif = check_card else: game = debug_test verif = check_dbg correct = 0 # If you can guess the committed values more than i&#39;d expect, then for _ in range(1337): if correct == 100: print(&#34;Oh wow, you broke my casino??!? Thanks so much for finding this before launch so i don&#39;t lose all my money to cheaters!&#34;) with open(&#34;flag.txt&#34;,&#34;r&#34;) as f: flag = f.read() print(f&#34;here&#39;s that flag you wanted, you earned it! {flag}&#34;) exit() comm, v, r = game(pk) print(f&#39;Commitment: {comm}&#39;) g = input(f&#39;Are you able to guess the value? [Y]es/[N]o&#39;) if g.lower() == &#34;n&#34;: print(f&#39;commited value was {v}&#39;) print(f&#39;randomness used was {r}&#39;) print(f&#39;verifies = {verif(pk,comm,v,r)}&#39;) elif g.lower() == &#34;y&#34;: guess = input(f&#39;whats your guess?&#39;) if verif(pk, comm, guess, r): correct &#43;= 1 print(&#34;Oh wow! well done!&#34;) else: print(&#34;That&#39;s not right... Why are you wasting my time if you haven&#39;t broken anything?&#34;) exit() print(f&#39;Guess my system is secure then! Lets go ahead with the launch!&#39;) exit() if __name__ == &#34;__main__&#34;: audit() ">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-17T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-03-22T23:06:00+07:00">
    <meta property="article:tag" content="CTF-Writeup">


  
  <link rel="canonical" href="http://localhost:40099/posts/kalmar2024/">

  
  
  
  <meta itemprop="name" content="KalmarCTF 2024">
  <meta itemprop="description" content="Last weekend, I played KalmarCTF 2024 with my team @1337%Yogurt. The cryptography category is very hard this year, so I could only manage to solve some of them. Here is my writeup for challenges that are solved by me.
Cracking The Casino casino.py
#!/usr/bin/python3 from Pedersen_commitments import gen, commit, verify # I want to host a trustworthy online casino! # To implement blackjack and craps in a trustworthy way i need verifiable dice and cards! # I&#39;ve used information theoretic commitments to prevent players from cheating. # Can you audit these functionalities for me ? from random import randint # Verifiable Dice roll def roll_dice(pk): roll = randint(1,6) comm, r = commit(pk,roll) return comm, roll, r # verifies a dice roll def check_dice(pk,comm,guess,r): res = verify(pk,comm, r, int(guess)) return res # verifiable random card: def draw_card(pk): idx = randint(0,51) # clubs spades diamonds hearts suits = &#34;CSDH&#34; values = &#34;234567890JQKA&#34; value = values[idx%13] suit = suits[idx//13] card = value &#43; suit comm, r = commit(pk, int(card.encode().hex(),16)) return comm, card, r # take a card (as two chars, fx 4S = 4 of spades) and verifies it was the committed card def check_card(pk, comm, guess, r): res = verify(pk, comm, r, int(guess.encode().hex(),16)) return res # Debug testing values for larger values def debug_test(pk): dbg = randint(0,2**32-2) comm, r = commit(pk,dbg) return comm, dbg, r # verify debug values def check_dbg(pk,comm,guess,r): res = verify(pk,comm, r, int(guess)) return res def audit(): print(&#34;Welcome to my (beta test) Casino!&#34;) q,g,h = gen() pk = q,g,h print(f&#39;public key for Pedersen Commitment Scheme is:\nq = {q}\ng = {g}\nh = {h}&#39;) chosen = input(&#34;what would you like to play?\n[D]ice\n[C]ards&#34;) if chosen.lower() == &#34;d&#34;: game = roll_dice verif = check_dice elif chosen.lower() == &#34;c&#34;: game = draw_card verif = check_card else: game = debug_test verif = check_dbg correct = 0 # If you can guess the committed values more than i&#39;d expect, then for _ in range(1337): if correct == 100: print(&#34;Oh wow, you broke my casino??!? Thanks so much for finding this before launch so i don&#39;t lose all my money to cheaters!&#34;) with open(&#34;flag.txt&#34;,&#34;r&#34;) as f: flag = f.read() print(f&#34;here&#39;s that flag you wanted, you earned it! {flag}&#34;) exit() comm, v, r = game(pk) print(f&#39;Commitment: {comm}&#39;) g = input(f&#39;Are you able to guess the value? [Y]es/[N]o&#39;) if g.lower() == &#34;n&#34;: print(f&#39;commited value was {v}&#39;) print(f&#39;randomness used was {r}&#39;) print(f&#39;verifies = {verif(pk,comm,v,r)}&#39;) elif g.lower() == &#34;y&#34;: guess = input(f&#39;whats your guess?&#39;) if verif(pk, comm, guess, r): correct &#43;= 1 print(&#34;Oh wow! well done!&#34;) else: print(&#34;That&#39;s not right... Why are you wasting my time if you haven&#39;t broken anything?&#34;) exit() print(f&#39;Guess my system is secure then! Lets go ahead with the launch!&#39;) exit() if __name__ == &#34;__main__&#34;: audit() ">
  <meta itemprop="datePublished" content="2024-03-17T00:00:00+00:00">
  <meta itemprop="dateModified" content="2024-03-22T23:06:00+07:00">
  <meta itemprop="wordCount" content="2372">
  <meta itemprop="keywords" content="CTF-Writeup">

  
  
  
    <link rel="stylesheet" href="/css/common.min.e562d763c6d0825495eb17de8b2c1d9800cf7c08db1c36accedf77a5fccfc4b9.css" integrity="sha256-5WLXY8bQglSV6xfeiywdmADPfAjbHDaszt93pfzPxLk=" crossorigin="anonymous">
  

  
  
    <link rel="stylesheet" href="/css/content.min.ba38eba94cb47fef9936258c42d11ff19fa9686a30b38e783773fe3f15eb44dc.css" integrity="sha256-ujjrqUy0f&#43;&#43;ZNiWMQtEf8Z&#43;paGows454N3P&#43;PxXrRNw=" crossorigin="anonymous">
  

  
  
  <title>KalmarCTF 2024 - Giap&#39;s Blog</title>
  

  
  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="KalmarCTF 2024">
  <meta name="twitter:description" content="Last weekend, I played KalmarCTF 2024 with my team @1337%Yogurt. The cryptography category is very hard this year, so I could only manage to solve some of them. Here is my writeup for challenges that are solved by me.
Cracking The Casino casino.py
#!/usr/bin/python3 from Pedersen_commitments import gen, commit, verify # I want to host a trustworthy online casino! # To implement blackjack and craps in a trustworthy way i need verifiable dice and cards! # I&#39;ve used information theoretic commitments to prevent players from cheating. # Can you audit these functionalities for me ? from random import randint # Verifiable Dice roll def roll_dice(pk): roll = randint(1,6) comm, r = commit(pk,roll) return comm, roll, r # verifies a dice roll def check_dice(pk,comm,guess,r): res = verify(pk,comm, r, int(guess)) return res # verifiable random card: def draw_card(pk): idx = randint(0,51) # clubs spades diamonds hearts suits = &#34;CSDH&#34; values = &#34;234567890JQKA&#34; value = values[idx%13] suit = suits[idx//13] card = value &#43; suit comm, r = commit(pk, int(card.encode().hex(),16)) return comm, card, r # take a card (as two chars, fx 4S = 4 of spades) and verifies it was the committed card def check_card(pk, comm, guess, r): res = verify(pk, comm, r, int(guess.encode().hex(),16)) return res # Debug testing values for larger values def debug_test(pk): dbg = randint(0,2**32-2) comm, r = commit(pk,dbg) return comm, dbg, r # verify debug values def check_dbg(pk,comm,guess,r): res = verify(pk,comm, r, int(guess)) return res def audit(): print(&#34;Welcome to my (beta test) Casino!&#34;) q,g,h = gen() pk = q,g,h print(f&#39;public key for Pedersen Commitment Scheme is:\nq = {q}\ng = {g}\nh = {h}&#39;) chosen = input(&#34;what would you like to play?\n[D]ice\n[C]ards&#34;) if chosen.lower() == &#34;d&#34;: game = roll_dice verif = check_dice elif chosen.lower() == &#34;c&#34;: game = draw_card verif = check_card else: game = debug_test verif = check_dbg correct = 0 # If you can guess the committed values more than i&#39;d expect, then for _ in range(1337): if correct == 100: print(&#34;Oh wow, you broke my casino??!? Thanks so much for finding this before launch so i don&#39;t lose all my money to cheaters!&#34;) with open(&#34;flag.txt&#34;,&#34;r&#34;) as f: flag = f.read() print(f&#34;here&#39;s that flag you wanted, you earned it! {flag}&#34;) exit() comm, v, r = game(pk) print(f&#39;Commitment: {comm}&#39;) g = input(f&#39;Are you able to guess the value? [Y]es/[N]o&#39;) if g.lower() == &#34;n&#34;: print(f&#39;commited value was {v}&#39;) print(f&#39;randomness used was {r}&#39;) print(f&#39;verifies = {verif(pk,comm,v,r)}&#39;) elif g.lower() == &#34;y&#34;: guess = input(f&#39;whats your guess?&#39;) if verif(pk, comm, guess, r): correct &#43;= 1 print(&#34;Oh wow! well done!&#34;) else: print(&#34;That&#39;s not right... Why are you wasting my time if you haven&#39;t broken anything?&#34;) exit() print(f&#39;Guess my system is secure then! Lets go ahead with the launch!&#39;) exit() if __name__ == &#34;__main__&#34;: audit() ">


  


  <link rel="stylesheet" href="/css/single.min.be779f459ad7e3aaf8afd0f80c6a61ca6c50993f5f18512532100ac6d93f0fa9.css" integrity="sha256-vnefRZrX46r4r9D4DGphymxQmT9fGFElMhAKxtk/D6k=" crossorigin="anonymous">


  <link rel="stylesheet" href="/css/single.min.78a121b7d7a160420f9daab0ea13add66c37b9c44f27bba07b27207e2b0975d2.css" integrity="sha256-eKEht9ehYEIPnaqw6hOt1mw3ucRPJ7ugeycgfisJddI=" crossorigin="anonymous">


</head>

<body>
  <div id="wrapper">
    


<header id="header">
  <h1>
    <a href="http://localhost:40099/">Giap&#39;s Blog</a>
    <button id="dark-mode-toggle" class="dark-mode-toggle" aria-label="Toggle theme">
        <svg width="2rem" height="2rem" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 496">
        <path fill="currentColor" d="M8,256C8,393,119,504,256,504S504,393,504,256,393,8,256,8,8,119,8,256ZM256,440V72a184,184,0,0,1,0,368Z" transform="translate(-8 -8)"/>
        </svg>
    </button>
  </h1>

  <nav>
    
    <span class="nav-bar-item">
      
        <span class="icon"><svg width="1em" height="1em" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M17,11H16a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm0,4H16a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2ZM11,9h6a1,1,0,0,0,0-2H11a1,1,0,0,0,0,2ZM21,3H7A1,1,0,0,0,6,4V7H3A1,1,0,0,0,2,8V18a3,3,0,0,0,3,3H18a4,4,0,0,0,4-4V4A1,1,0,0,0,21,3ZM6,18a1,1,0,0,1-2,0V9H6Zm14-1a2,2,0,0,1-2,2H7.82A3,3,0,0,0,8,18V5H20Zm-9-4h1a1,1,0,0,0,0-2H11a1,1,0,0,0,0,2Zm0,4h1a1,1,0,0,0,0-2H11a1,1,0,0,0,0,2Z"/></svg>
</span>
      
      <a class="link" href="/posts/">Blog</a>
    </span>
    
    <span class="nav-bar-item">
      
        <span class="icon"><svg width="1em" height="1em" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" data-name="Layer 1">
<path d="M10.07031,20.50291a1.00008,1.00008,0,0,0-1.18115-.9834c-1.30908.24024-2.96191.27637-3.40137-.958a5.70754,5.70754,0,0,0-1.83691-2.415,1.20073,1.20073,0,0,1-.1665-.10938,1,1,0,0,0-.93067-.64551H2.54883a.99965.99965,0,0,0-1,.99512c-.00391.81543.811,1.33789,1.1416,1.51465a4.4408,4.4408,0,0,1,.92383,1.35937c.36426,1.02344,1.42285,2.57617,4.46582,2.376.001.03516.00195.06836.00244.09863l.00439.26758a1,1,0,0,0,2,0l-.00488-.31836C10.07715,21.4951,10.07031,21.22068,10.07031,20.50291Zm10.667-15.126c.03174-.125.063-.26367.09034-.41992a6.27792,6.27792,0,0,0-.40821-3.293,1.002,1.002,0,0,0-.61572-.58007c-.356-.12012-1.67041-.35645-4.18408,1.25a13.86918,13.86918,0,0,0-6.354,0C6.76221.751,5.45459.9658,5.10205,1.07908a.99744.99744,0,0,0-.63135.584,6.3003,6.3003,0,0,0-.40332,3.35644c.02442.12793.05078.2461.07813.35449A6.26928,6.26928,0,0,0,2.89014,9.20311a8.42168,8.42168,0,0,0,.04248.92187c.334,4.60254,3.334,5.98438,5.42431,6.459-.04345.125-.083.25878-.11816.40039a1.00023,1.00023,0,0,0,1.94238.47851,1.6784,1.6784,0,0,1,.46778-.87793.99947.99947,0,0,0-.5459-1.74512c-3.4541-.39453-4.95362-1.80175-5.1792-4.89843a6.61076,6.61076,0,0,1-.03369-.73828,4.25769,4.25769,0,0,1,.91943-2.71289,3.022,3.022,0,0,1,.1958-.23145.99988.99988,0,0,0,.188-1.02441,3.3876,3.3876,0,0,1-.15527-.55567A4.09356,4.09356,0,0,1,6.1167,3.06346a7.54263,7.54263,0,0,1,2.415,1.17968,1.00877,1.00877,0,0,0,.82764.13282,11.77716,11.77716,0,0,1,6.17285.001,1.00549,1.00549,0,0,0,.83056-.13769,7.572,7.572,0,0,1,2.40528-1.19043,4.03977,4.03977,0,0,1,.0874,1.57812,3.205,3.205,0,0,1-.16895.60743.9999.9999,0,0,0,.188,1.02441c.07715.08691.1543.18066.22363.26855A4.12186,4.12186,0,0,1,20,9.20311a7.03888,7.03888,0,0,1-.0376.77734c-.22021,3.05566-1.72558,4.46387-5.1958,4.85937a1,1,0,0,0-.54541,1.7461,1.63079,1.63079,0,0,1,.46631.9082,3.06079,3.06079,0,0,1,.09229.81934v2.334C14.77,21.2949,14.77,21.78025,14.77,22.00291a1,1,0,1,0,2,0c0-.2168,0-.69238.00977-1.33984V18.31346a4.8815,4.8815,0,0,0-.15479-1.31153,4.25638,4.25638,0,0,0-.11621-.416,6.51258,6.51258,0,0,0,5.44531-6.42383A8.69677,8.69677,0,0,0,22,9.20311,6.13062,6.13062,0,0,0,20.7373,5.37693Z"/></svg>
</span>
      
      <a class="link" href="https://github.com/Giapppp">GitHub</a>
    </span>
    
  </nav>
</header>
<hr class="head-rule"></hr>
    
<main id="main" class="post">
  
  <div class="post-heading">
    <h1 class="post-title">KalmarCTF 2024</h1>
    <div class="publish-metadata">
      
      <svg width="0.75em" height="0.75em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M3 9H21M7 3V5M17 3V5M6 13H8M6 17H8M11 13H13M11 17H13M16 13H18M16 17H18M6.2 21H17.8C18.9201 21 19.4802 21 19.908 20.782C20.2843 20.5903 20.5903 20.2843 20.782 19.908C21 19.4802 21 18.9201 21 17.8V8.2C21 7.07989 21 6.51984 20.782 6.09202C20.5903 5.71569 20.2843 5.40973 19.908 5.21799C19.4802 5 18.9201 5 17.8 5H6.2C5.0799 5 4.51984 5 4.09202 5.21799C3.71569 5.40973 3.40973 5.71569 3.21799 6.09202C3 6.51984 3 7.07989 3 8.2V17.8C3 18.9201 3 19.4802 3.21799 19.908C3.40973 20.2843 3.71569 20.5903 4.09202 20.782C4.51984 21 5.07989 21 6.2 21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      17 March 2024
      
      
        &nbsp;
        <span>
          <svg width="0.75em" height="0.75em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M15.4998 5.49994L18.3282 8.32837M3 20.9997L3.04745 20.6675C3.21536 19.4922 3.29932 18.9045 3.49029 18.3558C3.65975 17.8689 3.89124 17.4059 4.17906 16.9783C4.50341 16.4963 4.92319 16.0765 5.76274 15.237L17.4107 3.58896C18.1918 2.80791 19.4581 2.80791 20.2392 3.58896C21.0202 4.37001 21.0202 5.63634 20.2392 6.41739L8.37744 18.2791C7.61579 19.0408 7.23497 19.4216 6.8012 19.7244C6.41618 19.9932 6.00093 20.2159 5.56398 20.3879C5.07171 20.5817 4.54375 20.6882 3.48793 20.9012L3 20.9997Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          2372 words
        </span>
      
      
      
        
      
      
        &nbsp;
        <span>
          <svg width="0.75em" height="0.75em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 7V12L14.5 13.5M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          ~12 mins
        </span>
      
    </div>
  </div>

  
  <div>
    
    <a class="link tag" href='http://localhost:40099/tags/ctf-writeup'>#CTF-Writeup</a>
    
    <br></br>
  </div>
  
  
  
  <details>
    <summary>
      <b>Table of Contents</b>
    </summary>
    <div class="toc numbered-subtitles"><nav id="TableOfContents">
  <ul>
    <li><a href="#cracking-the-casino">Cracking The Casino</a></li>
    <li><a href="#re-cracking-the-casino-">Re-Cracking The Casino *</a></li>
    <li><a href="#mathgolf-warmup">MathGolf-Warmup</a></li>
  </ul>
</nav></div>
  </details>
  
  
  <article class="content numbered-subtitles">
    
    <p>Last weekend, I played KalmarCTF 2024 with my team @1337%Yogurt. The cryptography category is very hard this year, so I could only manage to solve some of them. Here is my writeup for challenges that are solved by me.</p>
<h2 id="cracking-the-casino">Cracking The Casino</h2>
<p><code>casino.py</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/python3</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Pedersen_commitments</span> <span class="kn">import</span> <span class="n">gen</span><span class="p">,</span> <span class="n">commit</span><span class="p">,</span> <span class="n">verify</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># I want to host a trustworthy online casino!</span>
</span></span><span class="line"><span class="cl"><span class="c1"># To implement blackjack and craps in a trustworthy way i need verifiable dice and cards!</span>
</span></span><span class="line"><span class="cl"><span class="c1"># I&#39;ve used information theoretic commitments to prevent players from cheating.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Can you audit these functionalities for me ?</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Verifiable Dice roll</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">roll_dice</span><span class="p">(</span><span class="n">pk</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">roll</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">comm</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">commit</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span><span class="n">roll</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">comm</span><span class="p">,</span> <span class="n">roll</span><span class="p">,</span> <span class="n">r</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># verifies a dice roll</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">check_dice</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span><span class="n">comm</span><span class="p">,</span><span class="n">guess</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">res</span> <span class="o">=</span> <span class="n">verify</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span><span class="n">comm</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">guess</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">res</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># verifiable random card:</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">draw_card</span><span class="p">(</span><span class="n">pk</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">idx</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">51</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># clubs spades diamonds hearts</span>
</span></span><span class="line"><span class="cl">    <span class="n">suits</span> <span class="o">=</span> <span class="s2">&#34;CSDH&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">values</span> <span class="o">=</span> <span class="s2">&#34;234567890JQKA&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">value</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">idx</span><span class="o">%</span><span class="mi">13</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">suit</span> <span class="o">=</span> <span class="n">suits</span><span class="p">[</span><span class="n">idx</span><span class="o">//</span><span class="mi">13</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">card</span> <span class="o">=</span> <span class="n">value</span> <span class="o">+</span> <span class="n">suit</span>
</span></span><span class="line"><span class="cl">    <span class="n">comm</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">commit</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">card</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">(),</span><span class="mi">16</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">comm</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">r</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># take a card (as two chars, fx 4S = 4 of spades) and verifies it was the committed card</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">check_card</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">guess</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">res</span> <span class="o">=</span> <span class="n">verify</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">guess</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">(),</span><span class="mi">16</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">res</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Debug testing values for larger values</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">debug_test</span><span class="p">(</span><span class="n">pk</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">dbg</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">**</span><span class="mi">32</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">comm</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">commit</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span><span class="n">dbg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">comm</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">r</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># verify debug values</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">check_dbg</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span><span class="n">comm</span><span class="p">,</span><span class="n">guess</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">res</span> <span class="o">=</span> <span class="n">verify</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span><span class="n">comm</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">guess</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">res</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">audit</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Welcome to my (beta test) Casino!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">q</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">h</span> <span class="o">=</span> <span class="n">gen</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">pk</span> <span class="o">=</span> <span class="n">q</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">h</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;public key for Pedersen Commitment Scheme is:</span><span class="se">\n</span><span class="s1">q = </span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="se">\n</span><span class="s1">g = </span><span class="si">{</span><span class="n">g</span><span class="si">}</span><span class="se">\n</span><span class="s1">h = </span><span class="si">{</span><span class="n">h</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">chosen</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;what would you like to play?</span><span class="se">\n</span><span class="s2">[D]ice</span><span class="se">\n</span><span class="s2">[C]ards&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">chosen</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&#34;d&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">game</span> <span class="o">=</span> <span class="n">roll_dice</span>
</span></span><span class="line"><span class="cl">        <span class="n">verif</span> <span class="o">=</span> <span class="n">check_dice</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">chosen</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&#34;c&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">game</span> <span class="o">=</span> <span class="n">draw_card</span>
</span></span><span class="line"><span class="cl">        <span class="n">verif</span> <span class="o">=</span> <span class="n">check_card</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">game</span> <span class="o">=</span> <span class="n">debug_test</span>
</span></span><span class="line"><span class="cl">        <span class="n">verif</span> <span class="o">=</span> <span class="n">check_dbg</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># If you can guess the committed values more than i&#39;d expect, then</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1337</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">correct</span> <span class="o">==</span> <span class="mi">100</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Oh wow, you broke my casino??!? Thanks so much for finding this before launch so i don&#39;t lose all my money to cheaters!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;flag.txt&#34;</span><span class="p">,</span><span class="s2">&#34;r&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">flag</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;here&#39;s that flag you wanted, you earned it! </span><span class="si">{</span><span class="n">flag</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">exit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">comm</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">game</span><span class="p">(</span><span class="n">pk</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Commitment: </span><span class="si">{</span><span class="n">comm</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">g</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Are you able to guess the value? [Y]es/[N]o&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&#34;n&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;commited value was </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;randomness used was </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;verifies = </span><span class="si">{</span><span class="n">verif</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span><span class="n">comm</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">r</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">g</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&#34;y&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">guess</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;whats your guess?&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">verif</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">guess</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="n">correct</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Oh wow! well done!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;That&#39;s not right... Why are you wasting my time if you haven&#39;t broken anything?&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">exit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Guess my system is secure then! Lets go ahead with the launch!&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">exit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">audit</span><span class="p">()</span>
</span></span></code></pre></div><p><code>Pedersen_commitments.py</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="n">getStrongPrime</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.Random.random</span> <span class="kn">import</span> <span class="n">randint</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">## Implementation of Pedersen Commitment Scheme</span>
</span></span><span class="line"><span class="cl"><span class="c1">## Computationally binding, information theoreticly hiding</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Generate public key for Pedersen Commitments</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">gen</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">q</span> <span class="o">=</span> <span class="n">getStrongPrime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">g</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">h</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">q</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">q</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">h</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create Pedersen Commitment to message x</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">commit</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">q</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">pk</span>
</span></span><span class="line"><span class="cl">    <span class="n">r</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">comm</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">q</span><span class="p">)</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">q</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">comm</span> <span class="o">%=</span> <span class="n">q</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">comm</span><span class="p">,</span><span class="n">r</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Verify Pedersen Commitment to message x, with randomness r</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">verify</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">q</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">param</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">c</span> <span class="o">==</span> <span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">q</span><span class="p">)</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">q</span><span class="p">))</span> <span class="o">%</span> <span class="n">q</span>
</span></span></code></pre></div><p>Basically, you need to guess the message which is used for commitment. Because we have lots of rounds to try and Python <code>random</code> can be predictable if collect enough samples, so we can use <code>debug</code> mode to collect 624 32-bits messages, then we will be able to guess next message</p>
<p><code>solve.py</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">mt19937predictor</span> <span class="kn">import</span> <span class="n">MT19937Predictor</span> <span class="c1">#https://github.com/kmyk/mersenne-twister-predictor</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#target = process([&#34;python3&#34;, &#34;casino.py&#34;])</span>
</span></span><span class="line"><span class="cl"><span class="n">target</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;chal-kalmarc.tf&#34;</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">target</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">target</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">q</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()[</span><span class="mi">3</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()[</span><span class="mi">3</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl"><span class="n">h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()[</span><span class="mi">3</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">predictor</span> <span class="o">=</span> <span class="n">MT19937Predictor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">target</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;[C]ards&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">target</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;N</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">guess</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">game</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1337</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">comm</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()[</span><span class="nb">len</span><span class="p">(</span><span class="s2">&#34;Commitment:&#34;</span><span class="p">):])</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">guess</span> <span class="o">&lt;</span> <span class="mi">625</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">guess</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="n">target</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;[Y]es/[N]o&#34;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&#34;N&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">v</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()[</span><span class="nb">len</span><span class="p">(</span><span class="s2">&#34;commited value was &#34;</span><span class="p">):])</span>
</span></span><span class="line"><span class="cl">        <span class="n">r</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()[</span><span class="nb">len</span><span class="p">(</span><span class="s2">&#34;randomness used was &#34;</span><span class="p">):])</span>
</span></span><span class="line"><span class="cl">        <span class="n">target</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">predictor</span><span class="o">.</span><span class="n">setrandbits</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">target</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;[Y]es/[N]o&#34;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&#34;Y&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">target</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;whats your guess?&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">predictor</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">32</span><span class="o">-</span><span class="mi">2</span><span class="p">)))</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        <span class="n">target</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">game</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">game</span> <span class="o">==</span> <span class="mi">100</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">target</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></div><blockquote>
<p>Flag: Kalmar{First_Crypto_Down!}</p>
</blockquote>
<h2 id="re-cracking-the-casino-">Re-Cracking The Casino *</h2>
<p><code>casino.py</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/python3</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Pedersen_commitments</span> <span class="kn">import</span> <span class="n">gen</span><span class="p">,</span> <span class="n">commit</span><span class="p">,</span> <span class="n">verify</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># I want to host a trustworthy online casino!</span>
</span></span><span class="line"><span class="cl"><span class="c1"># To implement blackjack and craps in a trustworthy way i need verifiable dice and cards!</span>
</span></span><span class="line"><span class="cl"><span class="c1"># I&#39;ve used information theoretic commitments to prevent players from cheating.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Can you audit these functionalities for me ?</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Thanks for the feedback, I&#39;ll use secure randomness then!</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.Random.random</span> <span class="kn">import</span> <span class="n">randint</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Verifiable Dice roll</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">roll_dice</span><span class="p">(</span><span class="n">pk</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">roll</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">comm</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">commit</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span><span class="n">roll</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">comm</span><span class="p">,</span> <span class="n">roll</span><span class="p">,</span> <span class="n">r</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># verifies a dice roll</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">check_dice</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span><span class="n">comm</span><span class="p">,</span><span class="n">guess</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">res</span> <span class="o">=</span> <span class="n">verify</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span><span class="n">comm</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">guess</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">res</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># verifiable random card:</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">draw_card</span><span class="p">(</span><span class="n">pk</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">idx</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">51</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># clubs spades diamonds hearts</span>
</span></span><span class="line"><span class="cl">    <span class="n">suits</span> <span class="o">=</span> <span class="s2">&#34;CSDH&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">values</span> <span class="o">=</span> <span class="s2">&#34;234567890JQKA&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">value</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">idx</span><span class="o">%</span><span class="mi">13</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">suit</span> <span class="o">=</span> <span class="n">suits</span><span class="p">[</span><span class="n">idx</span><span class="o">//</span><span class="mi">13</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">card</span> <span class="o">=</span> <span class="n">value</span> <span class="o">+</span> <span class="n">suit</span>
</span></span><span class="line"><span class="cl">    <span class="n">comm</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">commit</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">card</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">(),</span><span class="mi">16</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">comm</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">r</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># take a card (as two chars, fx 4S = 4 of spades) and verifies it was the committed card</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">check_card</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">guess</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">res</span> <span class="o">=</span> <span class="n">verify</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">guess</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">(),</span><span class="mi">16</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">res</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Debug testing values for larger values</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">debug_test</span><span class="p">(</span><span class="n">pk</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">dbg</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">**</span><span class="mi">32</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">comm</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">commit</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span><span class="n">dbg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">comm</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">r</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># verify debug values</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">check_dbg</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span><span class="n">comm</span><span class="p">,</span><span class="n">guess</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">res</span> <span class="o">=</span> <span class="n">verify</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">guess</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">res</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">audit</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Welcome to my (Launch day!) Casino!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">q</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">h</span> <span class="o">=</span> <span class="n">gen</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">pk</span> <span class="o">=</span> <span class="n">q</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">h</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;public key for Pedersen Commitment Scheme is:</span><span class="se">\n</span><span class="s1">q = </span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="se">\n</span><span class="s1">g = </span><span class="si">{</span><span class="n">g</span><span class="si">}</span><span class="se">\n</span><span class="s1">h = </span><span class="si">{</span><span class="n">h</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">chosen</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;what would you like to play?</span><span class="se">\n</span><span class="s2">[D]ice</span><span class="se">\n</span><span class="s2">[C]ards&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">chosen</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&#34;d&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">game</span> <span class="o">=</span> <span class="n">roll_dice</span>
</span></span><span class="line"><span class="cl">        <span class="n">verif</span> <span class="o">=</span> <span class="n">check_dice</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">chosen</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&#34;c&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">game</span> <span class="o">=</span> <span class="n">draw_card</span>
</span></span><span class="line"><span class="cl">        <span class="n">verif</span> <span class="o">=</span> <span class="n">check_card</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">game</span> <span class="o">=</span> <span class="n">debug_test</span>
</span></span><span class="line"><span class="cl">        <span class="n">verif</span> <span class="o">=</span> <span class="n">check_dbg</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Should be secure now :)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">correct</span> <span class="o">==</span> <span class="mi">250</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Oh wow, you broke my casino again??!? That&#39;s impossible!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;flag.txt&#34;</span><span class="p">,</span><span class="s2">&#34;r&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">flag</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;here&#39;s that flag you wanted, you earned it! </span><span class="si">{</span><span class="n">flag</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">exit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">comm</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">game</span><span class="p">(</span><span class="n">pk</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Commitment: </span><span class="si">{</span><span class="n">comm</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">g</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Are you able to guess the value? [Y]es/[N]o&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&#34;n&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;commited value was </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;randomness used was </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;verifies = </span><span class="si">{</span><span class="n">verif</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span><span class="n">comm</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">r</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">g</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&#34;y&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">guess</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;whats your guess?&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">verif</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">guess</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="n">correct</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Oh wow! well done!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;That&#39;s not right... Why are you wasting my time if you haven&#39;t broken anything?&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">exit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Guess my system is secure then! Lets go ahead with the launch!&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">exit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">audit</span><span class="p">()</span>
</span></span></code></pre></div><p>(<code>Pedersen_commitments.py</code> is the same as first version&rsquo;s one)</p>
<p>This time, server use more secure random function, and we need to guess correct 250/256 times, so we need to find different method to solve instead of crack random like the first version</p>
<p>In this challenge, I chose <code>card</code> mode to reduce space to search. We can convert card to number that server uses, and save its prime factor into a list <code>factor</code></p>
<p>So why we need to do that ? We will solve discrete logarithm problem:</p>
<p>$$comm = g^x * h^r \mod q = g^{(x + rs)} \mod q$$(1)</p>
<p>When connect to the server, we will have a chance to have $(s, q - 1) = p &gt; 1$ where $p$ is a small prime. If $p$ doesn&rsquo;t exist in <code>factor</code>, then we can change the equation (1) to $comm = g^x \mod q$ and solve dlog over $\mathbb{F}_q$, and now we can bruteforce $x$ to satisfy the commitment function.</p>
<p><code>solve.py</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.Random.random</span> <span class="kn">import</span> <span class="n">randint</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="n">sieve_base</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">card_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12867</span><span class="p">,</span> <span class="mi">13123</span><span class="p">,</span> <span class="mi">13379</span><span class="p">,</span> <span class="mi">13635</span><span class="p">,</span> <span class="mi">13891</span><span class="p">,</span> <span class="mi">14147</span><span class="p">,</span> <span class="mi">14403</span><span class="p">,</span> <span class="mi">14659</span><span class="p">,</span> <span class="mi">12355</span><span class="p">,</span> <span class="mi">19011</span><span class="p">,</span> <span class="mi">20803</span><span class="p">,</span> <span class="mi">19267</span><span class="p">,</span> <span class="mi">16707</span><span class="p">,</span> <span class="mi">12883</span><span class="p">,</span> <span class="mi">13139</span><span class="p">,</span> <span class="mi">13395</span><span class="p">,</span> <span class="mi">13651</span><span class="p">,</span> <span class="mi">13907</span><span class="p">,</span> <span class="mi">14163</span><span class="p">,</span> <span class="mi">14419</span><span class="p">,</span> <span class="mi">14675</span><span class="p">,</span> <span class="mi">12371</span><span class="p">,</span> <span class="mi">19027</span><span class="p">,</span> <span class="mi">20819</span><span class="p">,</span> <span class="mi">19283</span><span class="p">,</span> <span class="mi">16723</span><span class="p">,</span> <span class="mi">12868</span><span class="p">,</span> <span class="mi">13124</span><span class="p">,</span> <span class="mi">13380</span><span class="p">,</span> <span class="mi">13636</span><span class="p">,</span> <span class="mi">13892</span><span class="p">,</span> <span class="mi">14148</span><span class="p">,</span> <span class="mi">14404</span><span class="p">,</span> <span class="mi">14660</span><span class="p">,</span> <span class="mi">12356</span><span class="p">,</span> <span class="mi">19012</span><span class="p">,</span> <span class="mi">20804</span><span class="p">,</span> <span class="mi">19268</span><span class="p">,</span> <span class="mi">16708</span><span class="p">,</span> <span class="mi">12872</span><span class="p">,</span> <span class="mi">13128</span><span class="p">,</span> <span class="mi">13384</span><span class="p">,</span> <span class="mi">13640</span><span class="p">,</span> <span class="mi">13896</span><span class="p">,</span> <span class="mi">14152</span><span class="p">,</span> <span class="mi">14408</span><span class="p">,</span> <span class="mi">14664</span><span class="p">,</span> <span class="mi">12360</span><span class="p">,</span> <span class="mi">19016</span><span class="p">,</span> <span class="mi">20808</span><span class="p">,</span> <span class="mi">19272</span><span class="p">,</span> <span class="mi">16712</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">factor</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">131</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">151</span><span class="p">,</span> <span class="mi">191</span><span class="p">,</span> <span class="mi">193</span><span class="p">,</span> <span class="mi">223</span><span class="p">,</span> <span class="mi">239</span><span class="p">,</span> <span class="mi">277</span><span class="p">,</span> <span class="mi">293</span><span class="p">,</span> <span class="mi">353</span><span class="p">,</span> <span class="mi">359</span><span class="p">,</span> <span class="mi">479</span><span class="p">,</span> <span class="mi">487</span><span class="p">,</span> <span class="mi">547</span><span class="p">,</span> <span class="mi">587</span><span class="p">,</span> <span class="mi">733</span><span class="p">,</span> <span class="mi">743</span><span class="p">,</span> <span class="mi">787</span><span class="p">,</span> <span class="mi">991</span><span class="p">,</span> <span class="mi">1193</span><span class="p">,</span> <span class="mi">1609</span><span class="p">,</span> <span class="mi">1753</span><span class="p">,</span> <span class="mi">1801</span><span class="p">,</span> <span class="mi">1877</span><span class="p">,</span> <span class="mi">2089</span><span class="p">,</span> <span class="mi">2377</span><span class="p">,</span> <span class="mi">2389</span><span class="p">,</span> <span class="mi">3089</span><span class="p">,</span> <span class="mi">3217</span><span class="p">,</span> <span class="mi">4177</span><span class="p">,</span> <span class="mi">4289</span><span class="p">,</span> <span class="mi">4721</span><span class="p">,</span> <span class="mi">4801</span><span class="p">,</span> <span class="mi">4817</span><span class="p">,</span> <span class="mi">5569</span><span class="p">,</span> <span class="mi">6337</span><span class="p">,</span> <span class="mi">13907</span><span class="p">,</span> <span class="mi">14419</span><span class="p">,</span> <span class="mi">19267</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">target</span> <span class="o">=</span> <span class="n">process</span><span class="p">([</span><span class="s2">&#34;python3&#34;</span><span class="p">,</span> <span class="s2">&#34;casino.py&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#target = remote(&#34;chal-kalmarc.tf&#34;, 13337)</span>
</span></span><span class="line"><span class="cl">        <span class="n">target</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">target</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">q</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()[</span><span class="mi">3</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl">        <span class="n">g</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()[</span><span class="mi">3</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl">        <span class="n">h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()[</span><span class="mi">3</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl">        <span class="n">target</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;[C]ards&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">target</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;C</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">divs</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">sieve_base</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">factor</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">divs</span> <span class="o">*=</span> <span class="n">p</span>
</span></span><span class="line"><span class="cl">        <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">divs</span>
</span></span><span class="line"><span class="cl">        <span class="n">hd</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">assert</span> <span class="n">hd</span> <span class="o">==</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="n">gd</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">assert</span> <span class="n">gd</span> <span class="o">!=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;OK&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">gds</span> <span class="o">=</span> <span class="p">[</span><span class="nb">pow</span><span class="p">(</span><span class="n">gd</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">card_values</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">gds</span><span class="p">))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">card_values</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">comm</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()[</span><span class="nb">len</span><span class="p">(</span><span class="s2">&#34;Commitment:&#34;</span><span class="p">):])</span>
</span></span><span class="line"><span class="cl">            <span class="n">commd</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">card_values</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="nb">pow</span><span class="p">(</span><span class="n">gd</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="o">==</span> <span class="n">commd</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">suits</span> <span class="o">=</span> <span class="s2">&#34;CSDH&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="n">values</span> <span class="o">=</span> <span class="s2">&#34;234567890JQKA&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="n">value</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">idx</span><span class="o">%</span><span class="mi">13</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                    <span class="n">suit</span> <span class="o">=</span> <span class="n">suits</span><span class="p">[</span><span class="n">idx</span><span class="o">//</span><span class="mi">13</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                    <span class="n">card</span> <span class="o">=</span> <span class="n">value</span> <span class="o">+</span> <span class="n">suit</span>
</span></span><span class="line"><span class="cl">            <span class="n">target</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;[Y]es/[N]o&#34;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&#34;Y&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">target</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;whats your guess?&#34;</span><span class="p">,</span> <span class="n">card</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">            <span class="n">target</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">target</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">target</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span></code></pre></div><blockquote>
<p>flag: Kalmar{Why_call_it_strong_if_its_so_weak&hellip;}</p>
</blockquote>
<h2 id="mathgolf-warmup">MathGolf-Warmup</h2>
<p><code>chal-warmup.py</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/env python3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># MathGolf-Warmup challenge by shalaamum for KalmarCTF 2024</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">signal</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sage.all</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">out_of_time</span><span class="p">(</span><span class="n">signum</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Time is up!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGALRM</span><span class="p">,</span> <span class="n">out_of_time</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">signal</span><span class="o">.</span><span class="n">alarm</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">sequence_slow</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">a0</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">a1</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">sequence</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">sequence</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span> <span class="o">%</span> <span class="n">p</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># sequence = sequence_slow</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">lib</span> <span class="kn">import</span> <span class="n">sequence_fast</span>
</span></span><span class="line"><span class="cl"><span class="n">sequence</span> <span class="o">=</span> <span class="n">sequence_fast</span>
</span></span><span class="line"><span class="cl"><span class="c1"># sequence_fast has the same return value as sequence_slow, it is just ...</span>
</span></span><span class="line"><span class="cl"><span class="c1"># faster.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#from Crypto.Util.number import getPrime</span>
</span></span><span class="line"><span class="cl"><span class="c1">#from Crypto.Random.random import randrange</span>
</span></span><span class="line"><span class="cl"><span class="c1">#class ProblemGenerator:</span>
</span></span><span class="line"><span class="cl"><span class="c1">#    def get(self):</span>
</span></span><span class="line"><span class="cl"><span class="c1">#        p = getPrime(64)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#        n = randrange(1, 1&lt;&lt;64)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#        b, c, a0, a1 = [randrange(0, p) for _ in range(4)]</span>
</span></span><span class="line"><span class="cl"><span class="c1">#        return n, b, c, a0, a1, p</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">lib</span> <span class="kn">import</span> <span class="n">ProblemGenerator</span>
</span></span><span class="line"><span class="cl"><span class="n">generator</span> <span class="o">=</span> <span class="n">ProblemGenerator</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1"># You can assume that ProblemGenerator acts as the above commented snippet.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># It just makes some tweaks that are intended to reduce the variance of the</span>
</span></span><span class="line"><span class="cl"><span class="c1"># run times. Trying to guess those tweaks is unlikely to be helpful to solve</span>
</span></span><span class="line"><span class="cl"><span class="c1"># the challenge.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Note: The reason in the comment above are for the non-warmup version of the</span>
</span></span><span class="line"><span class="cl"><span class="c1"># challenge.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_number</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()[</span><span class="mi">2</span><span class="p">:],</span> <span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">sequence_from_parameters</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">poly</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">phi</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">psi</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">const_phi</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">const_psi</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">Fp</span> <span class="o">=</span> <span class="n">sage</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">GF</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">RFp</span> <span class="o">=</span> <span class="n">sage</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">PolynomialRing</span><span class="p">(</span><span class="n">Fp</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">F</span> <span class="o">=</span> <span class="n">sage</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">GF</span><span class="p">(</span><span class="n">p</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">modulus</span><span class="o">=</span><span class="n">RFp</span><span class="p">(</span><span class="n">poly</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">    <span class="n">phi</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">psi</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">const_phi</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">const_phi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">const_psi</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">const_psi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">answer</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">phi</span><span class="o">**</span><span class="n">n</span> <span class="o">*</span> <span class="n">const_phi</span> <span class="o">-</span> <span class="n">psi</span><span class="o">**</span><span class="n">n</span> <span class="o">*</span> <span class="n">const_psi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">answer</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;That can&#39;t be right...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">answer</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Solved </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> of 100&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">n</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">p</span>  <span class="o">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;b  = 0x</span><span class="si">{</span><span class="n">b</span><span class="si">:</span><span class="s1">016x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;c  = 0x</span><span class="si">{</span><span class="n">c</span><span class="si">:</span><span class="s1">016x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;a0 = 0x</span><span class="si">{</span><span class="n">a0</span><span class="si">:</span><span class="s1">016x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;a1 = 0x</span><span class="si">{</span><span class="n">a1</span><span class="si">:</span><span class="s1">016x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;p  = 0x</span><span class="si">{</span><span class="n">p</span><span class="si">:</span><span class="s1">016x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Polynomial: &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_number</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_number</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;phi: &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_number</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_number</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;psi: &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_number</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_number</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;const_phi: &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_number</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_number</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;const_psi: &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_number</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_number</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Checking...&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">answer</span> <span class="o">=</span> <span class="n">sequence_from_parameters</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">correct</span> <span class="o">=</span> <span class="n">sequence</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">answer</span> <span class="o">!=</span> <span class="n">correct</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Incorrect! Correct answer was 0x</span><span class="si">{</span><span class="n">correct</span><span class="si">:</span><span class="s1">016x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;flag.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span></span></code></pre></div><p>In this challenge, we are asked to calculate nth element of the sequence:</p>
<p>$$\begin{aligned} a _ n = b * a _ {n - 1} + c * a _ {n - 2} \mod p \end{aligned}$$</p>
<p>I will explain how to find general term of $(a_n)$. First, we need to solve the quadratic equation (it is called <strong>characteristic equation</strong>):</p>
<p>$$x^2 - bx - c = 0 \mod p$$(1)</p>
<p>Our delta will be $\Delta = \sqrt{b^2 + 4c}$, and because we are working in $\mathbb{F}_p$, we have two scenarios</p>
<p><strong>Case 1:</strong> $\Delta$ is a quadratic residue modulo $p$</p>
<p>If $\Delta$ is a quadratic residue modulo $p$, so we can calculate two roots of (1) like normal. Suppose that our roots are $x_1$ and $x_2$, so the general term of our sequence will be $$a_n = u * x _ 1 ^ n + v * x _ 2 ^ n$$</p>
<p>Because server gives us $a_0$ and $a_1$, so we can calculate $u$ and $v$ easily, which are <code>const_phi</code> and <code>const_psi</code></p>
<p><strong>Case 2:</strong> $\Delta$ is a nonquadratic residue modulo $p$</p>
<p>Now, we can&rsquo;t work over $\mathbb{F} _ p$ because $\sqrt{\Delta}$ doesn&rsquo;t exist, so we need to work over $\mathbb{F} _ {p^2}$, and it is equivalent to $\mathbb{F} _ p[x]/(x^2 - \Delta)$. After extend the field, we can do the same as Case 1</p>
<p>Because server requires polynomial modulo in all cases, so for case 1, I bruteforce to find a number which is a quadratic nonresidue modulo $p$.</p>
<p><code>solve.py</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sage.all</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">sequence_fast</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">Fp</span> <span class="o">=</span> <span class="n">GF</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">RFp</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">Fp</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">t</span> <span class="o">=</span> <span class="n">RFp</span><span class="o">.</span><span class="n">gen</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">delta</span> <span class="o">=</span> <span class="n">Fp</span><span class="p">(</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">kronecker</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> 
</span></span><span class="line"><span class="cl">        <span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">delta</span><span class="o">.</span><span class="n">sqrt</span><span class="p">())</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span>
</span></span><span class="line"><span class="cl">        <span class="n">psi</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">delta</span><span class="o">.</span><span class="n">sqrt</span><span class="p">())</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span>
</span></span><span class="line"><span class="cl">        <span class="n">cpsi</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span> <span class="o">-</span> <span class="n">a0</span> <span class="o">*</span> <span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">phi</span> <span class="o">-</span> <span class="n">psi</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span>
</span></span><span class="line"><span class="cl">        <span class="n">cphi</span> <span class="o">=</span> <span class="p">(</span><span class="n">a0</span> <span class="o">+</span> <span class="n">cpsi</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span>
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">coeff</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">coeff</span><span class="p">)</span><span class="o">.</span><span class="n">is_irreducible</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[</span><span class="n">coeff</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cphi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cpsi</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">F</span> <span class="o">=</span> <span class="n">GF</span><span class="p">(</span><span class="n">p</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&#34;t&#34;</span><span class="p">,</span> <span class="n">modulus</span> <span class="o">=</span> <span class="n">RFp</span><span class="p">([</span><span class="o">-</span><span class="n">delta</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">        <span class="n">W</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">gen</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">W</span><span class="p">)</span> <span class="o">/</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">psi</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">W</span><span class="p">)</span> <span class="o">/</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">cpsi</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">a1</span> <span class="o">-</span> <span class="n">a0</span> <span class="o">*</span> <span class="n">phi</span><span class="p">)</span> <span class="o">/</span> <span class="n">F</span><span class="p">(</span><span class="n">phi</span> <span class="o">-</span> <span class="n">psi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">cphi</span> <span class="o">=</span> <span class="n">a0</span> <span class="o">+</span> <span class="n">cpsi</span>
</span></span><span class="line"><span class="cl">        <span class="n">ans</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">delta</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">cphi</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">cpsi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">ans</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">target</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;mathgolf.chal-kalmarc.tf&#34;</span><span class="p">,</span> <span class="s2">&#34;3470&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">target</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()[</span><span class="nb">len</span><span class="p">(</span><span class="s2">&#34;b  = &#34;</span><span class="p">):],</span> <span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">c</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()[</span><span class="nb">len</span><span class="p">(</span><span class="s2">&#34;c  = &#34;</span><span class="p">):],</span> <span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">a0</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()[</span><span class="nb">len</span><span class="p">(</span><span class="s2">&#34;a0 = &#34;</span><span class="p">):],</span> <span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">a1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()[</span><span class="nb">len</span><span class="p">(</span><span class="s2">&#34;a1 = &#34;</span><span class="p">):],</span> <span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()[</span><span class="nb">len</span><span class="p">(</span><span class="s2">&#34;p  = &#34;</span><span class="p">):],</span> <span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ans</span> <span class="o">=</span> <span class="n">sequence_fast</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">target</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">request</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">ans</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">ans</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">target</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">target</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">target</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></div><blockquote>
<p>flag: kalmar{generalized_fibonacci_sequence_in_a_finite_field__did_you_implement_everything_yourself_for_this__for_non-warmup_you_might_have_to}</p>
</blockquote>

    
  </article>

  <button onclick="topFunction()" id="back-to-top" title="Go to top">Back to Top</button>

  

<div id="sharingbuttons">
    
    
    <a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a40099%2fposts%2fkalmar2024%2f" target="_blank" rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/></svg>
        </div>
      </div>
    </a>
    

    
    
    <a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?text=KalmarCTF%202024&amp;url=http%3a%2f%2flocalhost%3a40099%2fposts%2fkalmar2024%2f" target="_blank" rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5 0-4.55 2.04-4.55 4.54 0 .36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3 0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35 0 12.92-6.92 12.92-12.93 0-.2 0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z"/></svg>
        </div>
      </div>
    </a>
    

    
    
    <a class="resp-sharing-button__link" href="mailto:?subject=KalmarCTF%202024&amp;body=http%3a%2f%2flocalhost%3a40099%2fposts%2fkalmar2024%2f" target="_self" rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 4H2C.9 4 0 4.9 0 6v12c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7.25 14.43l-3.5 2c-.08.05-.17.07-.25.07-.17 0-.34-.1-.43-.25-.14-.24-.06-.55.18-.68l3.5-2c.24-.14.55-.06.68.18.14.24.06.55-.18.68zm4.75.07c-.1 0-.2-.03-.27-.08l-8.5-5.5c-.23-.15-.3-.46-.15-.7.15-.22.46-.3.7-.14L12 13.4l8.23-5.32c.23-.15.54-.08.7.15.14.23.07.54-.16.7l-8.5 5.5c-.08.04-.17.07-.27.07zm8.93 1.75c-.1.16-.26.25-.43.25-.08 0-.17-.02-.25-.07l-3.5-2c-.24-.13-.32-.44-.18-.68s.44-.32.68-.18l3.5 2c.24.13.32.44.18.68z"/></svg>
        </div>
      </div>
    </a>
    

    
    
    <a class="resp-sharing-button__link" href="https://www.linkedin.com/sharing/share-offsite/?url=http%3a%2f%2flocalhost%3a40099%2fposts%2fkalmar2024%2f" target="_blank" rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.5 21.5h-5v-13h5v13zM4 6.5C2.5 6.5 1.5 5.3 1.5 4s1-2.4 2.5-2.4c1.6 0 2.5 1 2.6 2.5 0 1.4-1 2.5-2.6 2.5zm11.5 6c-1 0-2 1-2 2v7h-5v-13h5V10s1.6-1.5 4-1.5c3 0 5 2.2 5 6.3v6.7h-5v-7c0-1-1-2-2-2z"/></svg>
        </div>
      </div>
    </a>
    

    
    
    <a class="resp-sharing-button__link" href="https://reddit.com/submit/?url=http%3a%2f%2flocalhost%3a40099%2fposts%2fkalmar2024%2f&amp;resubmit=true&amp;title=KalmarCTF%202024" target="_blank" rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M24 11.5c0-1.65-1.35-3-3-3-.96 0-1.86.48-2.42 1.24-1.64-1-3.75-1.64-6.07-1.72.08-1.1.4-3.05 1.52-3.7.72-.4 1.73-.24 3 .5C17.2 6.3 18.46 7.5 20 7.5c1.65 0 3-1.35 3-3s-1.35-3-3-3c-1.38 0-2.54.94-2.88 2.22-1.43-.72-2.64-.8-3.6-.25-1.64.94-1.95 3.47-2 4.55-2.33.08-4.45.7-6.1 1.72C4.86 8.98 3.96 8.5 3 8.5c-1.65 0-3 1.35-3 3 0 1.32.84 2.44 2.05 2.84-.03.22-.05.44-.05.66 0 3.86 4.5 7 10 7s10-3.14 10-7c0-.22-.02-.44-.05-.66 1.2-.4 2.05-1.54 2.05-2.84zM2.3 13.37C1.5 13.07 1 12.35 1 11.5c0-1.1.9-2 2-2 .64 0 1.22.32 1.6.82-1.1.85-1.92 1.9-2.3 3.05zm3.7.13c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zm9.8 4.8c-1.08.63-2.42.96-3.8.96-1.4 0-2.74-.34-3.8-.95-.24-.13-.32-.44-.2-.68.15-.24.46-.32.7-.18 1.83 1.06 4.76 1.06 6.6 0 .23-.13.53-.05.67.2.14.23.06.54-.18.67zm.2-2.8c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm5.7-2.13c-.38-1.16-1.2-2.2-2.3-3.05.38-.5.97-.82 1.6-.82 1.1 0 2 .9 2 2 0 .84-.53 1.57-1.3 1.87z"/></svg>
        </div>
      </div>
    </a>
    

    
    
    <a class="resp-sharing-button__link" href="whatsapp://send?text=http%3a%2f%2flocalhost%3a40099%2fposts%2fkalmar2024%2f" target="_blank" rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.1 3.9C17.9 1.7 15 .5 12 .5 5.8.5.7 5.6.7 11.9c0 2 .5 3.9 1.5 5.6L.6 23.4l6-1.6c1.6.9 3.5 1.3 5.4 1.3 6.3 0 11.4-5.1 11.4-11.4-.1-2.8-1.2-5.7-3.3-7.8zM12 21.4c-1.7 0-3.3-.5-4.8-1.3l-.4-.2-3.5 1 1-3.4L4 17c-1-1.5-1.4-3.2-1.4-5.1 0-5.2 4.2-9.4 9.4-9.4 2.5 0 4.9 1 6.7 2.8 1.8 1.8 2.8 4.2 2.8 6.7-.1 5.2-4.3 9.4-9.5 9.4zm5.1-7.1c-.3-.1-1.7-.9-1.9-1-.3-.1-.5-.1-.7.1-.2.3-.8 1-.9 1.1-.2.2-.3.2-.6.1s-1.2-.5-2.3-1.4c-.9-.8-1.4-1.7-1.6-2-.2-.3 0-.5.1-.6s.3-.3.4-.5c.2-.1.3-.3.4-.5.1-.2 0-.4 0-.5C10 9 9.3 7.6 9 7c-.1-.4-.4-.3-.5-.3h-.6s-.4.1-.7.3c-.3.3-1 1-1 2.4s1 2.8 1.1 3c.1.2 2 3.1 4.9 4.3.7.3 1.2.5 1.6.6.7.2 1.3.2 1.8.1.6-.1 1.7-.7 1.9-1.3.2-.7.2-1.2.2-1.3-.1-.3-.3-.4-.6-.5z"/></svg>
        </div>
      </div>
    </a>
    

    
    
    <a class="resp-sharing-button__link" href="https://news.ycombinator.com/submitlink?u=http%3a%2f%2flocalhost%3a40099%2fposts%2fkalmar2024%2f&amp;t=KalmarCTF%202024" target="_blank" rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--hackernews resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    	<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 140 140"><path fill-rule="evenodd" d="M60.94 82.314L17 0h20.08l25.85 52.093c.397.927.86 1.888 1.39 2.883.53.994.995 2.02 1.393 3.08.265.4.463.764.596 1.095.13.334.262.63.395.898.662 1.325 1.26 2.618 1.79 3.877.53 1.26.993 2.42 1.39 3.48 1.06-2.254 2.22-4.673 3.48-7.258 1.26-2.585 2.552-5.27 3.877-8.052L103.49 0h18.69L77.84 83.308v53.087h-16.9v-54.08z"></path></svg>
        </div>
      </div>
    </a>
    

    
    
    <a class="resp-sharing-button__link" href="https://telegram.me/share/url?text=KalmarCTF%202024&amp;url=http%3a%2f%2flocalhost%3a40099%2fposts%2fkalmar2024%2f" target="_blank" rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--telegram resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M.707 8.475C.275 8.64 0 9.508 0 9.508s.284.867.718 1.03l5.09 1.897 1.986 6.38a1.102 1.102 0 0 0 1.75.527l2.96-2.41a.405.405 0 0 1 .494-.013l5.34 3.87a1.1 1.1 0 0 0 1.046.135 1.1 1.1 0 0 0 .682-.803l3.91-18.795A1.102 1.102 0 0 0 22.5.075L.706 8.475z"/></svg>
        </div>
      </div>
    </a>
    
</div>
  <div class="paginator">
    
    <a class="link" href="http://localhost:40099/posts/zkp3/" title="Zero Knowledge Proof: Interactive Proofs">← prev</a>
    
    
    <a class="link" href="http://localhost:40099/posts/zkp4/" title="Zero Knowledge Proof: The PLONK SNARK">next →</a>
    
  </div>
  <div class="comment">
    
    
    
    <script src="https://giscus.app/client.js"
    data-repo="michaelneuper/hugo-texify3"
    data-repo-id="R_kgDOIjPNaQ"
    data-category="General"
    data-category-id="DIC_kwDOIjPNac4CaklA"
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme=""
    data-lang="en"
    data-loading="lazy"
    crossorigin="anonymous"
    async>
</script>

  </div>
  
  
</main>

    <footer id="footer">
  <div>
    <span>Powered by  <a class=link href=https://gohugo.io target=_blank rel=noopener>Hugo</a> | 
Theme <a class=link href=https://github.com/michaelneuper/hugo-texify3 target=_blank rel=noopener>TeXify3</a>
</span>
  </div>
  <div>
    <span>Copyright © 2024 Michael Neuper</span>
  </div>
</footer>

  </div>

  
  <script src='http://localhost:40099/js/script.js' defer></script>

  
  

  
  

  
  

</body>

</html>
